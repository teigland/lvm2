#
# Copyright (C) 2011-2012 Red Hat, Inc.
#
# This file is part of LVM2.
#
# This copyrighted material is made available to anyone wishing to use,
# modify, copy, or redistribute it subject to the terms and conditions
# of the GNU Lesser General Public License v.2.1.
#
# You should have received a copy of the GNU Lesser General Public License
# along with this program; if not, write to the Free Software Foundation,
# Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA

LVMETAD_SOURCE = daemons/lvmetad/lvmetad-core.c
LVMETAD_DEPENDS = $(subst .c,.d,$(LVMETAD_SOURCE))
LVMETAD_OBJECTS = $(subst .c,.o,$(LVMETAD_SOURCE))
CLEAN_TARGETS += $(LVMETAD_DEPENDS) $(LVMETAD_OBJECTS)

-include $(LVMETAD_DEPENDS)

LVMETAD_SOURCES2 = daemons/lvmetad/lvmetactl.c
LVMETAD_DEPENDS2 = $(subst .c,.d,$(LVMETAD_SOURCE2))
LVMETAD_OBJECTS2 = $(subst .c,.o,$(LVMETAD_SOURCE2))
CLEAN_TARGETS += $(LVMETAD_DEPENDS2) $(LVMETAD_OBJECTS2)

-include $(LVMETAD_DEPENDS2)

TARGETS += daemons/lvmetad/lvmetad daemons/lvmetad/lvmetactl

.PHONY: install_lvmetad

# FIXME: put back
#CFLOW_LIST = $(SOURCES)
#CFLOW_LIST_TARGET = $(LIB_NAME).cflow
#CFLOW_TARGET = lvmetad

$(LVMETAD_OBJECTS) $(LVMETAD_OBJECTS2): CFLAGS += $(EXTRA_EXEC_CFLAGS)
$(LVMETAD_OBJECTS) $(LVMETAD_OBJECTS2): INCLUDES += -Ilibdaemon/server
daemons/lvmetad/lvmetad daemons/lvmetad/lvmetactl: LDFLAGS += -Llibdaemon/server $(EXTRA_EXEC_LDFLAGS) $(ELDFLAGS)
daemons/lvmetad/lvmetad daemons/lvmetad/lvmetactl: LIBS += $(RT_LIBS) $(DAEMON_LIBS) -ldevmapper $(PTHREAD_LIBS)

daemons/lvmetad/lvmetad: $(LVMETAD_OBJECTS) libdaemon/client/libdaemonclient.a \
		    libdaemon/server/libdaemonserver.a
	@echo "    [LD] $@"
	$(Q) $(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(LVMETAD_OBJECTS) -ldaemonserver $(LIBS)

daemons/lvmetad/lvmetactl: daemons/lvmetad/lvmetactl.o libdaemon/client/libdaemonclient.a \
	libdaemon/server/libdaemonserver.a
	@echo "    [LD] $@"
	$(Q) $(CC) $(CFLAGS) $(LDFLAGS) -o $@ daemons/lvmetad/lvmetactl.o $(LIBS)

CLEAN_TARGETS += daemons/lvmetad/lvmetad daemons/lvmetad/lvmetactl

install_lvmetad: daemons/lvmetad/lvmetad
	$(INSTALL_PROGRAM) -D $< $(sbindir)/$(<F)

install_lvm2: install_lvmetad

install: install_lvm2

