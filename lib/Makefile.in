#
# Copyright (C) 2001-2004 Sistina Software, Inc. All rights reserved.
# Copyright (C) 2004-2018 Red Hat, Inc. All rights reserved.
#
# This file is part of LVM2.
#
# This copyrighted material is made available to anyone wishing to use,
# modify, copy, or redistribute it subject to the terms and conditions
# of the GNU General Public License v.2.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software Foundation,
# Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA

LIB_SOURCE=\
	lib/activate/activate.c \
	lib/cache/lvmcache.c \
	lib/cache_segtype/cache.c \
	lib/commands/toolcontext.c \
	lib/config/config.c \
	lib/datastruct/btree.c \
	lib/datastruct/str_list.c \
	lib/device/bcache.c \
	lib/device/dev-cache.c \
	lib/device/dev-ext.c \
	lib/device/dev-io.c \
	lib/device/dev-md.c \
	lib/device/dev-swap.c \
	lib/device/dev-type.c \
	lib/device/dev-luks.c \
	lib/device/dev-dasd.c \
	lib/display/display.c \
	lib/error/errseg.c \
	lib/unknown/unknown.c \
	lib/filters/filter-composite.c \
	lib/filters/filter-persistent.c \
	lib/filters/filter-regex.c \
	lib/filters/filter-sysfs.c \
	lib/filters/filter-md.c \
	lib/filters/filter-fwraid.c \
	lib/filters/filter-mpath.c \
	lib/filters/filter-partitioned.c \
	lib/filters/filter-type.c \
	lib/filters/filter-usable.c \
	lib/filters/filter-internal.c \
	lib/format_text/archive.c \
	lib/format_text/archiver.c \
	lib/format_text/export.c \
	lib/format_text/flags.c \
	lib/format_text/format-text.c \
	lib/format_text/import.c \
	lib/format_text/import_vsn1.c \
	lib/format_text/text_label.c \
	lib/freeseg/freeseg.c \
	lib/label/label.c \
	lib/locking/file_locking.c \
	lib/locking/locking.c \
	lib/locking/no_locking.c \
	lib/log/log.c \
	lib/metadata/cache_manip.c \
	lib/metadata/lv.c \
	lib/metadata/lv_manip.c \
	lib/metadata/merge.c \
	lib/metadata/metadata.c \
	lib/metadata/metadata-liblvm.c \
	lib/metadata/mirror.c \
	lib/metadata/pool_manip.c \
	lib/metadata/pv.c \
	lib/metadata/pv_manip.c \
	lib/metadata/pv_map.c \
	lib/metadata/raid_manip.c \
	lib/metadata/segtype.c \
	lib/metadata/snapshot_manip.c \
	lib/metadata/thin_manip.c \
	lib/metadata/vg.c \
	lib/mirror/mirrored.c \
	lib/misc/crc.c \
	lib/misc/lvm-exec.c \
	lib/misc/lvm-file.c \
	lib/misc/lvm-flock.c \
	lib/misc/lvm-globals.c \
	lib/misc/lvm-maths.c \
	lib/misc/lvm-signal.c \
	lib/misc/lvm-string.c \
	lib/misc/lvm-wrappers.c \
	lib/misc/lvm-percent.c \
	lib/mm/memlock.c \
	lib/notify/lvmnotify.c \
	lib/properties/prop_common.c \
	lib/raid/raid.c \
	lib/report/properties.c \
	lib/report/report.c \
	lib/snapshot/snapshot.c \
	lib/striped/striped.c \
	lib/thin/thin.c \
	lib/uuid/uuid.c \
	lib/zero/zero.c

ifeq ("@CLUSTER@", "internal")
  LIB_SOURCE += lib/locking/cluster_locking.c
endif

ifeq ("@DEVMAPPER@", "yes")
  LIB_SOURCE +=\
	lib/activate/dev_manager.c \
	lib/activate/fs.c
endif

ifeq ("@HAVE_LIBDL@", "yes")
  LIB_SOURCE +=\
	lib/locking/external_locking.c \
	lib/misc/sharedlib.c
endif

ifeq ("@BUILD_LVMETAD@", "yes")
  LIB_SOURCE +=\
	lib/cache/lvmetad.c
endif

ifeq ("@BUILD_LVMPOLLD@", "yes")
  LIB_SOURCE +=\
	lib/lvmpolld/lvmpolld-client.c
endif

ifeq ("@BUILD_LVMLOCKD@", "yes")
  LIB_SOURCE +=\
	lib/locking/lvmlockd.c
endif

LIB_DEPENDS=$(subst .c,.d,$(LIB_SOURCE))
LIB_OBJECTS=$(subst .c,.o,$(LIB_SOURCE))
CLEAN_TARGETS+=$(LIB_DEPENDS) $(LIB_OBJECTS) lib/liblvm-internal.a

lib/liblvm-internal.a: $(LIB_OBJECTS)
	@echo "    [AR] $@"
	$(Q) $(RM) $@
	$(Q) $(AR) rsv $@ $(LIB_OBJECTS) > /dev/null

# FIXME: put these back in
#CFLOW_LIST = $(SOURCES)
#CFLOW_LIST_TARGET = $(LIB_NAME).cflow
#PROGS_CFLAGS = $(BLKID_CFLAGS) $(UDEV_CFLAGS)

-include $(LIB_DEPENDS)
